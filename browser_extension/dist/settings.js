import{u as A,r as c,j as t,S as B,a as W}from"./assets/styles-CeEoALjS.js";const $=[{value:"today",label:"Today"},{value:"yesterday",label:"Yesterday"},{value:"week",label:"This week"},{value:"month",label:"This month"},{value:"all",label:"All"}];function Y(){const{isConnected:y,connect:v,sendMessage:p}=A(),[N,w]=c.useState(""),[j,S]=c.useState(""),[F,u]=c.useState(""),[M,m]=c.useState(""),[E,b]=c.useState([]),[_,I]=c.useState("today"),[P,L]=c.useState("");c.useEffect(()=>{const e=()=>{var a;typeof chrome<"u"&&((a=chrome.storage)!=null&&a.local)&&chrome.storage.local.get(["notificationEmail","notificationPhone"],s=>{typeof s.notificationEmail=="string"&&w(s.notificationEmail),typeof s.notificationPhone=="string"&&S(s.notificationPhone)})},n=async()=>{var a;try{const s=await p({type:"get_user_info"});if(s!=null&&s.error){m("Loaded from local storage (native DB unavailable)."),e();return}const r=typeof(s==null?void 0:s.email)=="string"?s.email:"",d=typeof(s==null?void 0:s.phone)=="string"?s.phone:"";if(!r&&!d){m("No native profile found. Showing local values."),e();return}w(r),S(d),typeof chrome<"u"&&((a=chrome.storage)!=null&&a.local)&&await chrome.storage.local.set({notificationEmail:r,notificationPhone:d}),m("Loaded Profile Information")}catch{m("Loaded from local storage (native DB unavailable)."),e()}},i=async()=>{try{const a=await p({type:"get_low_reputation_history",limit:1e3});if(a!=null&&a.error){b([]);return}const s=Array.isArray(a==null?void 0:a.items)?a.items:[];b(s)}catch{b([])}};(async()=>{const a=await v();if(!(a!=null&&a.success)){m("Loaded from local storage (native DB unavailable)."),e(),b([]);return}await n(),await i()})()},[v,p]);const T=e=>{const n=Number(e||0);return n?new Date(n*1e3).toLocaleString():"Unknown time"},C=(()=>{if(!Array.isArray(E))return[];const e=o=>String(o||"").toLowerCase().trim(),n=e(P),f=n.match(/^\d+(\.\d+)?%?$/)?Math.min(Math.max(Number.parseFloat(n.replace("%","")),0),100):null,a=(o,x)=>{if(!x)return!0;const h=e(o);if(!h)return!1;let g=0;for(let l=0;l<h.length&&g<x.length;l+=1)h[l]===x[g]&&(g+=1);return g===x.length},s=new Date,r=new Date(s.getFullYear(),s.getMonth(),s.getDate()),d=new Date(r);d.setDate(d.getDate()+1);const k=new Date(r);k.setDate(k.getDate()-1);const H=(r.getDay()+6)%7,D=new Date(r);D.setDate(D.getDate()-H);const O=new Date(s.getFullYear(),s.getMonth(),1);return E.filter(o=>{const x=Number((o==null?void 0:o.created_at)||0),h=Number((o==null?void 0:o.safety_score)??0)*100;if(f!==null&&(Number.isNaN(h)||h<f)||!(f!==null?!0:a(o==null?void 0:o.domain,n)||a(o==null?void 0:o.visited_url,n)))return!1;if(!x)return _==="all";const l=new Date(x*1e3);switch(_){case"today":return l>=r&&l<d;case"yesterday":return l>=k&&l<r;case"week":return l>=D;case"month":return l>=O;case"all":default:return!0}})})(),z=async()=>{var n;if(typeof chrome>"u"||!((n=chrome.storage)!=null&&n.local)){u("Unable to save on this page.");return}await chrome.storage.local.set({notificationEmail:N.trim(),notificationPhone:j.trim()});const e=await v();if(!(e!=null&&e.success)){u("Saved locally, but native save failed.");return}try{const i=await p({type:"save_user_info",email:N.trim(),phone:j.trim()});if(i!=null&&i.error){u("Saved locally, but native save failed.");return}}catch{u("Saved locally, but native save failed.");return}u("Notification contacts saved.")};return t.jsxs("div",{className:"min-h-screen w-full bg-gradient-to-b from-slate-50 to-slate-100 flex flex-col",children:[t.jsx("header",{className:"border-b border-slate-200 bg-white px-5 py-4",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2.5",children:[t.jsx("div",{className:"size-9 rounded-xl bg-indigo-600 flex items-center justify-center shadow-sm",children:t.jsx(B,{className:"size-4 text-white",strokeWidth:2.5})}),t.jsxs("div",{children:[t.jsx("h1",{className:"text-base font-semibold tracking-tight text-slate-900",children:"SafeNest"}),t.jsx("p",{className:"text-[11px] text-slate-500",children:"Child safety monitor"})]})]}),t.jsxs("div",{className:`flex items-center gap-1.5 text-xs font-medium ${y?"text-emerald-700":"text-rose-700"}`,children:[t.jsx("span",{className:`size-1.5 rounded-full ${y?"bg-emerald-500":"bg-rose-500"}`}),y?"Connected":"Offline"]})]})}),t.jsx("div",{className:"flex-1 w-full overflow-y-auto",children:t.jsxs("div",{className:"mx-auto w-full max-w-5xl px-4 py-6 sm:px-6 lg:px-8",children:[t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-5 sm:p-6",children:[t.jsx("p",{className:"text-base font-semibold text-slate-900",children:"Settings"}),t.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Configure SafeNest behavior for your familyâ€™s browsing experience."}),M&&t.jsx("p",{className:"mt-2 text-xs text-indigo-700",children:M})]}),t.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-4 md:grid-cols-1",children:[t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-5 sm:p-6",children:[t.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Notifications"}),t.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Add where SafeNest should send alerts and reports."}),t.jsxs("div",{className:"mt-4 space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notification-email",className:"block text-xs font-medium text-slate-700",children:"Email"}),t.jsx("input",{id:"notification-email",type:"email",value:N,onChange:e=>w(e.target.value),placeholder:"parent@example.com",className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"})]}),t.jsxs("div",{children:[t.jsx("label",{htmlFor:"notification-phone",className:"block text-xs font-medium text-slate-700",children:"Phone number"}),t.jsx("input",{id:"notification-phone",type:"tel",value:j,onChange:e=>S(e.target.value),placeholder:"+1 555 123 4567",className:"mt-1 w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"})]}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsx("p",{className:"text-xs text-slate-500",children:"Used for safety notifications only."}),t.jsx("button",{type:"button",onClick:z,className:"inline-flex items-center rounded-lg bg-indigo-600 px-3 py-2 text-xs font-semibold text-white hover:bg-indigo-500",children:"Save"})]}),F&&t.jsx("p",{className:"text-xs text-emerald-700",children:F})]})]}),t.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-5 sm:p-6",children:[t.jsxs("div",{className:"flex items-start justify-between gap-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"History"}),t.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"Sites visited with safety score below 70%."})]}),t.jsxs("div",{className:"w-full max-w-[520px]",children:[t.jsx("label",{htmlFor:"history-filter",className:"block text-xs font-medium text-slate-700 text-right",children:"Filter"}),t.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[t.jsx("input",{id:"history-search",type:"text",value:P,onChange:e=>L(e.target.value),placeholder:"Search websites or min score (e.g. 70 or 70%)",className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200"}),t.jsx("select",{id:"history-filter",value:_,onChange:e=>I(e.target.value),className:"w-full max-w-[220px] rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 outline-none focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200",children:$.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsx("p",{className:"mt-1 text-xs text-slate-500 text-right",children:"Tip: enter a number to show sites with protection score at or above that value."})]})]}),t.jsxs("div",{className:"mt-4 max-h-[440px] overflow-y-auto pr-1 space-y-3",children:[C.length===0&&t.jsx("p",{className:"text-sm text-slate-500",children:"No low-reputation sites recorded yet."}),C.map((e,n)=>{const i=Number((e==null?void 0:e.safety_score)??0)*100,f=(e==null?void 0:e.blocked_page_shown)===!0||(e==null?void 0:e.action_taken)==="page_blocked";return t.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-3",children:[t.jsx("p",{className:"text-sm font-semibold text-slate-900",children:(e==null?void 0:e.domain)||"unknown domain"}),t.jsx("p",{className:"mt-1 text-xs text-slate-600 break-all",children:(e==null?void 0:e.visited_url)||""}),t.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-xs",children:[t.jsxs("span",{className:"rounded bg-rose-100 px-2 py-0.5 font-medium text-rose-700",children:["Safety: ",i.toFixed(1),"%"]}),t.jsx("span",{className:"rounded bg-slate-200 px-2 py-0.5 font-medium text-slate-700",children:(e==null?void 0:e.analysis_type)||"analysis"}),t.jsx("span",{className:"rounded bg-slate-200 px-2 py-0.5 font-medium text-slate-700",children:(e==null?void 0:e.page_classification)||"unknown"}),f&&t.jsx("span",{className:"rounded bg-red-600 px-2 py-0.5 font-semibold text-white",children:"Blocked"})]}),t.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Visited: ",T(e==null?void 0:e.created_at)]}),(e==null?void 0:e.reasons)&&t.jsxs("p",{className:"mt-1 text-xs text-slate-500",children:["Reasons: ",e.reasons]})]},`${(e==null?void 0:e.visited_url)||"visit"}-${(e==null?void 0:e.created_at)||n}-${n}`)})]})]})]})]})})]})}const U=document.getElementById("root"),Q=W(U);Q.render(t.jsx(Y,{}));
